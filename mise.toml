# mise configuration for Rustatio
# https://mise.jdx.dev/

[settings]
lockfile = true

[tools]
# Node.js for UI development
node = "latest"

# Rust with components (rustfmt and clippy)
[tools.rust]
version = "latest"
profile = "default"  # default profile includes rustfmt and clippy

[env]
CARGO_TERM_COLOR = "always"
RUST_BACKTRACE = "1"

# Project-specific paths
_.path = ["./node_modules/.bin", "./ui/node_modules/.bin"]

[tasks.install]
description = "Install all dependencies"
run = [
    "echo 'ğŸ“¦ Installing Rust dependencies...'",
    "cargo fetch",
    "echo 'ğŸ“¦ Installing UI dependencies...'",
    "cd ui && npm ci",
    "echo 'âœ… All dependencies installed!'"
]

[tasks.dev]
description = "Run development server"
depends = ["install"]
run = [
    "echo 'ğŸš€ Starting Tauri development server...'",
    "cd ui && npm run dev &",
    "sleep 2",
    "cargo tauri dev"
]

[tasks.run-app]
description = "Build UI and run the application directly"
depends = ["install"]
run = [
    "echo 'ğŸ—ï¸  Building UI...'",
    "cd ui && npm run build",
    "echo 'ğŸš€ Running application...'",
    "cargo run"
]

[tasks.build]
description = "Build for production"
depends = ["install"]
run = [
    "echo 'ğŸ—ï¸  Building UI...'",
    "cd ui && npm run build",
    "echo 'ğŸ—ï¸  Building Rust backend...'",
    "cargo build --release",
    "echo 'âœ… Build complete!'"
]

[tasks.build-tauri]
description = "Build Tauri application for production"
depends = ["install"]
run = [
    "echo 'ğŸ—ï¸  Building Tauri app...'",
    "cd ui && npm run build",
    "cargo tauri build",
    "echo 'âœ… Tauri build complete!'"
]

[tasks.test]
description = "Run all tests"
depends = ["install"]
run = [
    "echo 'ğŸ§ª Running Rust tests...'",
    "cargo test",
    "echo 'âœ… All tests passed!'"
]

[tasks.lint]
description = "Run all linters"
depends = ["install"]
run = [
    "echo 'ğŸ” Linting Rust code...'",
    "cargo clippy --all-targets --all-features -- -D warnings",
    "echo 'ğŸ” Linting UI code...'",
    "cd ui && npm run lint",
    "echo 'âœ… All linting passed!'"
]

[tasks.format]
description = "Format all code"
run = [
    "echo 'ğŸ’… Formatting Rust code...'",
    "cargo fmt",
    "echo 'ğŸ’… Formatting UI code...'",
    "cd ui && npm run format",
    "echo 'âœ… All code formatted!'"
]

[tasks.format-check]
description = "Check code formatting without modifying"
run = [
    "echo 'ğŸ” Checking Rust formatting...'",
    "cargo fmt --check",
    "echo 'ğŸ” Checking UI formatting...'",
    "cd ui && npm run format:check",
    "echo 'âœ… Format check complete!'"
]

[tasks.check]
description = "Run all checks (format, lint, test)"
depends = ["format-check", "lint", "test"]
run = "echo 'âœ… All checks passed!'"

[tasks.clean]
description = "Clean build artifacts"
run = [
    "echo 'ğŸ§¹ Cleaning Rust build artifacts...'",
    "cargo clean",
    "echo 'ğŸ§¹ Cleaning UI build artifacts...'",
    "rm -rf ui/dist ui/node_modules/.vite",
    "echo 'âœ… Clean complete!'"
]

[tasks.clean-all]
description = "Clean all build artifacts and dependencies"
run = [
    "echo 'ğŸ§¹ Cleaning all artifacts and dependencies...'",
    "cargo clean",
    "rm -rf ui/dist ui/node_modules",
    "echo 'âœ… Deep clean complete!'"
]

[tasks.update]
description = "Update all dependencies"
run = [
    "echo 'ğŸ“¦ Updating Rust dependencies...'",
    "cargo update",
    "echo 'ğŸ“¦ Updating UI dependencies...'",
    "cd ui && npm update",
    "echo 'âœ… Dependencies updated!'"
]

[tasks.audit]
description = "Audit dependencies for security vulnerabilities"
run = [
    "echo 'ğŸ”’ Auditing Rust dependencies...'",
    "cargo audit || echo 'Install cargo-audit: cargo install cargo-audit'",
    "echo 'ğŸ”’ Auditing UI dependencies...'",
    "cd ui && npm audit",
    "echo 'âœ… Audit complete!'"
]

[tasks.release-check]
description = "Pre-release checks (format, lint, test, build)"
run = [
    "echo 'ğŸš€ Running pre-release checks...'",
    "mise run format-check",
    "mise run lint",
    "mise run test",
    "mise run build-tauri",
    "echo 'âœ… Ready for release!'"
]

[tasks.ci]
description = "Run CI checks (same as GitHub Actions)"
run = [
    "echo 'ğŸ”„ Running CI checks...'",
    "mise run format-check",
    "mise run lint",
    "mise run test",
    "mise run build",
    "echo 'âœ… CI checks passed!'"
]

# UI-specific tasks
[tasks.ui-install]
description = "Install UI dependencies only"
run = "cd ui && npm ci"

[tasks.ui-build]
description = "Build UI for production"
depends = ["ui-install"]
run = "cd ui && npm run build"

[tasks.ui-preview]
description = "Preview production UI build"
run = "cd ui && npm run preview"

# Rust-specific tasks
[tasks.rust-build]
description = "Build Rust backend only"
run = "cargo build --release"

[tasks.rust-test]
description = "Run Rust tests only"
run = "cargo test"

[tasks.rust-doc]
description = "Generate Rust documentation"
run = "cargo doc --open --no-deps"

# Version management
[tasks.version]
description = "Show current version"
run = "grep '^version' Cargo.toml | head -1"

# Convenience aliases
[tasks.d]
alias = "dev"

[tasks.b]
alias = "build"

[tasks.t]
alias = "test"

[tasks.l]
alias = "lint"

[tasks.f]
alias = "format"

[tasks.c]
alias = "check"
